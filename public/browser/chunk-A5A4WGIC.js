import{a as O,b as z}from"./chunk-ID43W4MK.js";import{a as L}from"./chunk-INBQAGGS.js";import{H as x,I as C,Ia as h,Ja as i,Ka as a,La as S,Oa as _,Pa as g,Qa as v,Ra as k,Sa as E,Ta as I,V as p,Va as o,W as m,Wa as l,Xa as V,Ya as u,Za as b,h as M,i as y,lb as T,mb as $,oa as s,ob as F,pb as B,qb as A,ta as P,v as f,xa as w,za as D}from"./chunk-7TNZWGYD.js";var Y=["hiddenDateInput"];function j(c,t){if(c&1&&(i(0,"tr")(1,"td"),o(2),a(),i(3,"td"),o(4),a(),i(5,"td"),o(6),u(7,"date"),a(),i(8,"td"),o(9),u(10,"date"),a()()),c&2){let e=t.$implicit,n=t.index;s(2),l(n+1),s(2),l(e.co),s(2),l(b(7,4,e.fecha_hora,"yyyy-MM-dd")),s(3),l(b(10,7,e.fecha_hora,"HH:mm"))}}function Q(c,t){if(c&1){let e=_();i(0,"button",17),g("click",function(){let r=p(e).$implicit,d=v();return m(d.selectDate(r))}),o(1),a()}if(c&2){let e=t.$implicit,n=v();h("ngClass",n.getDateClass(e)),s(),V(" ",n.formatDate(e)," ")}}O.register(...z);var N=class c{constructor(t){this.caService=t}data=[];chartData=[];chart;avg=0;min=0;max=0;today=new Date;selectedDate=new Date;visibleDates=[];destroy$=new M;pollingIntervalMs=5e3;tableLimit=5;selectedDate$=new y(this.selectedDate);hiddenDateInput;ngOnInit(){this.updateVisibleDates(),this.loadDataForDate(this.selectedDate),f(this.pollingIntervalMs).pipe(C(this.destroy$),x(()=>this.caService.getByDate(this.selectedDate$.value))).subscribe(t=>{this.chartData=t,this.initChart(this.chartData),this.computeStats(this.chartData)}),f(this.pollingIntervalMs).pipe(C(this.destroy$),x(()=>this.isToday(this.selectedDate$.value)?this.caService.getLatestByDate(this.selectedDate$.value,this.tableLimit):this.caService.getByDate(this.selectedDate$.value))).subscribe(t=>this.data=t)}ngAfterViewInit(){this.chartData.length&&this.initChart(this.chartData)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadDataForDate(t){this.selectedDate=new Date(t),this.selectedDate$.next(this.selectedDate),this.updateVisibleDates(),this.caService.getByDate(t).subscribe(e=>{this.chartData=e,this.initChart(this.chartData),this.computeStats(this.chartData)}),this.isToday(t)?this.caService.getLatestByDate(t,this.tableLimit).subscribe(e=>{this.data=e}):this.caService.getByDate(t).subscribe(e=>{this.data=e})}initChart(t){let e=document.getElementById("coChart");if(!e)return;this.chart&&this.chart.destroy();let n=t.map(r=>new Date(r.fecha_hora).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));this.chart=new O(e,{type:"line",data:{labels:n,datasets:[{label:"CO (ppm)",data:t.map(r=>r.co),borderColor:"#2980b9",backgroundColor:"rgba(41, 128, 185, 0.2)",fill:!0,tension:.3}]},options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{x:{display:!0},y:{display:!0}}}})}computeStats(t){if(!t?.length)return;let e=t.map(r=>Number(r.co)||0),n=e.reduce((r,d)=>r+d,0);this.avg=n/e.length,this.min=Math.min(...e),this.max=Math.max(...e)}updateVisibleDates(){this.visibleDates=[];for(let t=-3;t<=3;t++){let e=new Date(this.selectedDate.getTime());e.setDate(e.getDate()+t),this.visibleDates.push(e)}}isToday(t){let e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}formatDate(t){return this.isToday(t)?"Hoy":`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}`}selectDate(t){this.loadDataForDate(t)}getDateClass(t){return this.isToday(t)?"today":t.toDateString()===this.selectedDate.toDateString()?"selected":""}openCalendar(){this.hiddenDateInput.nativeElement.click()}onDatePicked(t){let e=new Date(t.target.value);isNaN(e.getTime())||this.selectDate(e)}shiftVisibleDates(t){this.visibleDates=this.visibleDates.map(e=>{let n=new Date(e.getTime());return n.setDate(n.getDate()+t),n})}static \u0275fac=function(e){return new(e||c)(P(L))};static \u0275cmp=w({type:c,selectors:[["app-co"]],viewQuery:function(e,n){if(e&1&&k(Y,5),e&2){let r;E(r=I())&&(n.hiddenDateInput=r.first)}},decls:50,vars:8,consts:[["hiddenDateInput",""],[1,"dashboard"],[1,"content"],[1,"records-section"],[1,"records-table"],[4,"ngFor","ngForOf"],[1,"stats-section"],[1,"stats"],[1,"card"],[1,"chart-section"],["id","coChart"],[1,"date-bar-container"],[1,"arrow-button",3,"click"],[1,"date-bar"],[3,"ngClass","click",4,"ngFor","ngForOf"],[1,"calendar-container"],["type","date",1,"hidden-date-input",3,"change"],[3,"click","ngClass"]],template:function(e,n){if(e&1){let r=_();i(0,"div",1)(1,"main",2)(2,"h1"),o(3,"Mon\xF3xido de Carbono (CO)"),a(),i(4,"section",3)(5,"h2"),o(6,"\xDAltimos registros"),a(),i(7,"table",4)(8,"thead")(9,"tr")(10,"th"),o(11,"#"),a(),i(12,"th"),o(13,"CO"),a(),i(14,"th"),o(15,"Fecha"),a(),i(16,"th"),o(17,"Hora"),a()()(),i(18,"tbody"),D(19,j,11,10,"tr",5),a()()(),i(20,"section",6)(21,"div",7)(22,"div",8)(23,"h3"),o(24,"Promedio"),a(),i(25,"p"),o(26),u(27,"number"),a()(),i(28,"div",8)(29,"h3"),o(30,"M\xEDnimo"),a(),i(31,"p"),o(32),a()(),i(33,"div",8)(34,"h3"),o(35,"M\xE1ximo"),a(),i(36,"p"),o(37),a()()()(),i(38,"section",9),S(39,"canvas",10),a(),i(40,"div",11)(41,"button",12),g("click",function(){return p(r),m(n.shiftVisibleDates(-1))}),o(42,"\u2190"),a(),i(43,"div",13),D(44,Q,2,2,"button",14),a(),i(45,"button",12),g("click",function(){return p(r),m(n.shiftVisibleDates(1))}),o(46,"\u2192"),a(),i(47,"div",15)(48,"input",16,0),g("change",function(H){return p(r),m(n.onDatePicked(H))}),a()()()()()}e&2&&(s(19),h("ngForOf",n.data),s(7),l(b(27,5,n.avg,"1.1-2")),s(6),l(n.min),s(5),l(n.max),s(7),h("ngForOf",n.visibleDates))},dependencies:[A,T,$,B,F],styles:[".dashboard[_ngcontent-%COMP%]{display:flex;min-height:100vh;font-family:Arial,sans-serif}.content[_ngcontent-%COMP%]{flex:1;padding:30px;background-color:#ecf0f1}.content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:26px;color:#2c3e50}.stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:40px}.card[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 6px #0000001a;text-align:center}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px;color:#2980b9}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#333}.records-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:#fff;box-shadow:0 2px 6px #0000001a;border-radius:8px;overflow:hidden}.records-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .records-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 15px;text-align:left;border-bottom:1px solid #ddd}.records-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2980b9;color:#fff;font-weight:700}.records-section[_ngcontent-%COMP%], .stats-section[_ngcontent-%COMP%]{margin-bottom:40px}.chart-section[_ngcontent-%COMP%]{margin-top:20px}.date-bar-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:15px}.date-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s;background-color:#f0f0f0;font-family:inherit;font-weight:400}.date-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d0d0d0}.date-bar[_ngcontent-%COMP%]   button.today[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;font-weight:700}.date-bar[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#e0e0e0;font-weight:700}.date-bar[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]:hover{background-color:silver}.calendar-button[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:4px;background-color:#2980b9;color:#fff;cursor:pointer;font-size:16px;transition:background-color .2s}.calendar-button[_ngcontent-%COMP%]:hover{background-color:#1f6391}.calendar-button[_ngcontent-%COMP%]{padding:8px 14px;font-size:16px;background-color:#2980b9;color:#fff;border:none;border-radius:6px;cursor:pointer;box-shadow:0 3px 6px #00000026;transition:background-color .2s,transform .1s,box-shadow .2s}.calendar-button[_ngcontent-%COMP%]:hover{background-color:#1f6391;transform:translateY(-2px);box-shadow:0 5px 10px #0003}.calendar-button[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 3px 6px #00000026}.calendar-container[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:8px 14px;font-size:14px;border:none;border-radius:8px;background-color:#3498db;color:#fff;font-weight:700;cursor:pointer;transition:background-color .3s,transform .1s}.calendar-container[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]:hover{background-color:#2980b9;transform:translateY(-1px)}.calendar-container[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 4px 10px #2980b966;background-color:#2980b9}.date-bar-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:15px}.arrow-button[_ngcontent-%COMP%]{background-color:#2980b9;color:#fff;border:none;padding:5px 10px;font-size:18px;border-radius:5px;cursor:pointer;transition:.2s}.arrow-button[_ngcontent-%COMP%]:hover{background-color:#1f618d}.date-bar[_ngcontent-%COMP%]{display:flex;gap:5px}.calendar-container[_ngcontent-%COMP%]{margin-left:10px}.calendar-button[_ngcontent-%COMP%]{background-color:#27ae60;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer}"]})};export{N as COComponent};
