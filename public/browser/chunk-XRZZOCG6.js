import{a as u,b as I}from"./chunk-ID43W4MK.js";import{a as w}from"./chunk-INBQAGGS.js";import{H as g,I as m,Ia as D,Ja as n,Ka as a,La as _,Va as o,Wa as c,Ya as f,Za as x,h as v,mb as M,oa as s,ob as O,pb as E,qb as P,ta as y,u as b,v as p,xa as C,za as S}from"./chunk-7TNZWGYD.js";function T(l,t){if(l&1&&(n(0,"tr")(1,"td"),o(2),a(),n(3,"td"),o(4),a(),n(5,"td"),o(6),f(7,"date"),a(),n(8,"td"),o(9),f(10,"date"),a()()),l&2){let e=t.$implicit,i=t.index;s(2),c(i+1),s(2),c(e.nox),s(2),c(x(7,4,e.fecha_hora,"yyyy-MM-dd")),s(3),c(x(10,7,e.fecha_hora,"HH:mm"))}}u.register(...I);var N=class l{constructor(t){this.caService=t}data=[];chartData=[];chart;avg=0;min=0;max=0;destroy$=new v;pollingIntervalMs=5e3;fullRefreshIntervalMs=5e3;tableLimit=5;ngOnInit(){b([this.caService.getAll(),this.caService.getLatest(this.tableLimit)]).pipe(m(this.destroy$)).subscribe(([t,e])=>{this.chartData=(t||[]).sort((i,r)=>new Date(i.fecha_hora).getTime()-new Date(r.fecha_hora).getTime()),this.initChart(this.chartData),this.computeStats(this.chartData),this.data=(e||[]).reverse()}),p(this.pollingIntervalMs).pipe(m(this.destroy$),g(()=>{if(!this.chartData.length)return this.caService.getAll();let t=this.chartData[this.chartData.length-1].fecha_hora;return this.caService.getSince(t)})).subscribe(t=>{t?.length&&this.appendToChart(t)}),p(this.fullRefreshIntervalMs).pipe(m(this.destroy$),g(()=>this.caService.getAll())).subscribe(t=>{t?.length&&(this.chartData=t.sort((e,i)=>new Date(e.fecha_hora).getTime()-new Date(i.fecha_hora).getTime()),this.initChart(this.chartData),this.computeStats(this.chartData))}),p(this.pollingIntervalMs).pipe(m(this.destroy$),g(()=>this.caService.getLatest(this.tableLimit))).subscribe(t=>this.data=(t||[]).reverse())}ngAfterViewInit(){this.chartData.length&&this.initChart(this.chartData)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initChart(t){let e=new Date,i=t.filter(d=>new Date(d.fecha_hora).toDateString()===e.toDateString()),r=document.getElementById("noxChart");if(!r)return;this.chart&&this.chart.destroy();let h=i.map(d=>new Date(d.fecha_hora).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));this.chart=new u(r,{type:"line",data:{labels:h,datasets:[{label:"NOx (ppm)",data:i.map(d=>d.nox),borderColor:"#2980b9",backgroundColor:"rgba(41, 128, 185, 0.2)",fill:!0,tension:.3}]},options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{x:{display:!0},y:{display:!0}}}}),this.computeStats(i)}appendToChart(t){let e=new Date,i=t.filter(r=>new Date(r.fecha_hora).toDateString()===e.toDateString());i.length&&(i.forEach(r=>this.chartData.push(r)),i.forEach(r=>{let h=new Date(r.fecha_hora).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});this.chart.data.labels.push(h),this.chart.data.datasets[0].data.push(r.nox)}),this.chart.update(),this.computeStats(this.chartData.filter(r=>new Date(r.fecha_hora).toDateString()===e.toDateString())))}computeStats(t){if(!t?.length)return;let e=t.map(r=>Number(r.nox)||0),i=e.reduce((r,h)=>r+h,0);this.avg=i/e.length,this.min=Math.min(...e),this.max=Math.max(...e)}static \u0275fac=function(e){return new(e||l)(y(w))};static \u0275cmp=C({type:l,selectors:[["app-nox"]],decls:40,vars:7,consts:[[1,"dashboard"],[1,"content"],[1,"records-section"],[1,"records-table"],[4,"ngFor","ngForOf"],[1,"stats-section"],[1,"stats"],[1,"card"],[1,"chart-section"],["id","noxChart"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"main",1)(2,"h1"),o(3,"Oxido de Nitr\xF3geno (NOX)"),a(),n(4,"section",2)(5,"h2"),o(6,"\xDAltimos registros"),a(),n(7,"table",3)(8,"thead")(9,"tr")(10,"th"),o(11,"#"),a(),n(12,"th"),o(13,"NOX"),a(),n(14,"th"),o(15,"Fecha"),a(),n(16,"th"),o(17,"Hora"),a()()(),n(18,"tbody"),S(19,T,11,10,"tr",4),a()()(),n(20,"section",5)(21,"div",6)(22,"div",7)(23,"h3"),o(24,"Promedio"),a(),n(25,"p"),o(26),f(27,"number"),a()(),n(28,"div",7)(29,"h3"),o(30,"M\xEDnimo"),a(),n(31,"p"),o(32),a()(),n(33,"div",7)(34,"h3"),o(35,"M\xE1ximo"),a(),n(36,"p"),o(37),a()()()(),n(38,"section",8),_(39,"canvas",9),a()()()),e&2&&(s(19),D("ngForOf",i.data),s(7),c(x(27,4,i.avg,"1.1-2")),s(6),c(i.min),s(5),c(i.max))},dependencies:[P,M,E,O],styles:[".dashboard[_ngcontent-%COMP%]{display:flex;min-height:100vh;font-family:Arial,sans-serif}.content[_ngcontent-%COMP%]{flex:1;padding:30px;background-color:#ecf0f1}.content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:20px;font-size:26px;color:#2c3e50}.stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:40px}.card[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 6px #0000001a;text-align:center}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px;color:#2980b9}.card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#333}.records-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;background-color:#fff;box-shadow:0 2px 6px #0000001a;border-radius:8px;overflow:hidden}.records-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .records-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 15px;text-align:left;border-bottom:1px solid #ddd}.records-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2980b9;color:#fff;font-weight:700}.records-section[_ngcontent-%COMP%], .stats-section[_ngcontent-%COMP%]{margin-bottom:40px}.chart-section[_ngcontent-%COMP%]{margin-top:20px}"]})};export{N as NoxComponent};
